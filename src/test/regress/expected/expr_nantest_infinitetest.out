-- For expression IS [NOT] NAN|INFINITE
-- create new schema
drop schema if exists expr_nan;
NOTICE:  schema "expr_nan" does not exist, skipping
create schema expr_nan;
set search_path=expr_nan;
CREATE TABLE tnf (c1 int, c2 bigint, c3 float8, c4 varchar(50), c5 text, c6 timestamp);
INSERT INTO tnf VALUES (1, 10000, 100.008, '1234.5679', '987654321', TIMESTAMP'2024-06-06 21:03:58');
INSERT INTO tnf VALUES (2, -922337203, -1.79E+100, '-1.79E+100', '1.79E+100', TIMESTAMP'1970-01-01 00:00:00');
INSERT INTO tnf VALUES (3, 922337203, 1.79E+100, '9,223,372,036,854,775,807', '1.79E+400',  TIMESTAMP'2077-07-08 00:00:00');
INSERT INTO tnf VALUES (4, NULL, NULL, NULL, NULL, NULL);
INSERT INTO tnf VALUES (5, -0,  CAST('NaN' as float8), 'tonight', '12.34yesterday', 'today');
INSERT INTO tnf VALUES (6, 3.14E+3, CAST('Inf' as float8), 'NaN', 'Inf', 'now');
SELECT c1, c2 FROM tnf WHERE c1 = 1 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 1 AND c2 IS NOT NAN;
 c1 |  c2   
----+-------
  1 | 10000
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 1 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 1 AND c2 IS NOT INFINITE;
 c1 |  c2   
----+-------
  1 | 10000
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 2 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 2 AND c2 IS NOT NAN;
 c1 |     c2     
----+------------
  2 | -922337203
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 2 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 2 AND c2 IS NOT INFINITE;
 c1 |     c2     
----+------------
  2 | -922337203
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 3 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 3 AND c2 IS NOT NAN;
 c1 |    c2     
----+-----------
  3 | 922337203
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 3 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 3 AND c2 IS NOT INFINITE;
 c1 |    c2     
----+-----------
  3 | 922337203
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 4 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 4 AND c2 IS NOT NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 4 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 4 AND c2 IS NOT INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 5 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 5 AND c2 IS NOT NAN;
 c1 | c2 
----+----
  5 |  0
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 5 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 5 AND c2 IS NOT INFINITE;
 c1 | c2 
----+----
  5 |  0
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 6 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 6 AND c2 IS NOT NAN;
 c1 |  c2  
----+------
  6 | 3140
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 6 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 6 AND c2 IS NOT INFINITE;
 c1 |  c2  
----+------
  6 | 3140
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 1 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 1 AND c3 IS NOT NAN;
 c1 |   c3    
----+---------
  1 | 100.008
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 1 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 1 AND c3 IS NOT INFINITE;
 c1 |   c3    
----+---------
  1 | 100.008
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 2 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 2 AND c3 IS NOT NAN;
 c1 |     c3     
----+------------
  2 | -1.79e+100
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 2 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 2 AND c3 IS NOT INFINITE;
 c1 |     c3     
----+------------
  2 | -1.79e+100
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 3 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 3 AND c3 IS NOT NAN;
 c1 |    c3     
----+-----------
  3 | 1.79e+100
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 3 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 3 AND c3 IS NOT INFINITE;
 c1 |    c3     
----+-----------
  3 | 1.79e+100
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 4 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 4 AND c3 IS NOT NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 4 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 4 AND c3 IS NOT INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 5 AND c3 IS NAN;
 c1 | c3  
----+-----
  5 | NaN
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 5 AND c3 IS NOT NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 5 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 5 AND c3 IS NOT INFINITE;
 c1 | c3  
----+-----
  5 | NaN
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 6 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 6 AND c3 IS NOT NAN;
 c1 |    c3    
----+----------
  6 | Infinity
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 6 AND c3 IS INFINITE;
 c1 |    c3    
----+----------
  6 | Infinity
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 6 AND c3 IS NOT INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 1 AND c4 IS NAN;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 1 AND c4 IS NOT NAN;
 c1 |    c4     
----+-----------
  1 | 1234.5679
(1 row)

SELECT c1, c4 FROM tnf WHERE c1 = 1 AND c4 IS INFINITE;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 1 AND c4 IS NOT INFINITE;
 c1 |    c4     
----+-----------
  1 | 1234.5679
(1 row)

SELECT c1, c4 FROM tnf WHERE c1 = 2 AND c4 IS NAN;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 2 AND c4 IS NOT NAN;
 c1 |     c4     
----+------------
  2 | -1.79E+100
(1 row)

SELECT c1, c4 FROM tnf WHERE c1 = 2 AND c4 IS INFINITE;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 2 AND c4 IS NOT INFINITE;
 c1 |     c4     
----+------------
  2 | -1.79E+100
(1 row)

SELECT c1, c4 FROM tnf WHERE c1 = 3 AND c4 IS NAN;  -- error: invalid number
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c1, c4 FROM tnf WHERE c1 = 3 AND c4 IS NOT NAN;  -- error: invalid number
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c1, c4 FROM tnf WHERE c1 = 3 AND c4 IS INFINITE;  -- error: invalid number
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c1, c4 FROM tnf WHERE c1 = 3 AND c4 IS NOT INFINITE;  -- error: invalid number
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c1, c4 FROM tnf WHERE c1 = 4 AND c4 IS NAN;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 4 AND c4 IS NOT NAN;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 4 AND c4 IS INFINITE;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 4 AND c4 IS NOT INFINITE;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 5 AND c4 IS NAN; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "tonight"
SELECT c1, c4 FROM tnf WHERE c1 = 5 AND c4 IS NOT NAN; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "tonight"
SELECT c1, c4 FROM tnf WHERE c1 = 5 AND c4 IS INFINITE; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "tonight"
SELECT c1, c4 FROM tnf WHERE c1 = 5 AND c4 IS NOT INFINITE; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "tonight"
SELECT c1, c4 FROM tnf WHERE c1 = 6 AND c4 IS NAN; -- error: invalid number
ERROR:  invalid input for IS [NOT] NAN
SELECT c1, c4 FROM tnf WHERE c1 = 6 AND c4 IS NOT NAN; -- error: invalid number
ERROR:  invalid input for IS [NOT] NAN
SELECT c1, c4 FROM tnf WHERE c1 = 6 AND c4 IS INFINITE; -- error: invalid number
ERROR:  invalid input for IS [NOT] INFINITE
SELECT c1, c4 FROM tnf WHERE c1 = 6 AND c4 IS NOT INFINITE; -- error: invalid number
ERROR:  invalid input for IS [NOT] INFINITE
SELECT c1, c5 FROM tnf WHERE c1 = 1 AND c5 IS NAN;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 1 AND c5 IS NOT NAN;
 c1 |    c5     
----+-----------
  1 | 987654321
(1 row)

SELECT c1, c5 FROM tnf WHERE c1 = 1 AND c5 IS INFINITE;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 1 AND c5 IS NOT INFINITE;
 c1 |    c5     
----+-----------
  1 | 987654321
(1 row)

SELECT c1, c5 FROM tnf WHERE c1 = 2 AND c5 IS NAN;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 2 AND c5 IS NOT NAN;
 c1 |    c5     
----+-----------
  2 | 1.79E+100
(1 row)

SELECT c1, c5 FROM tnf WHERE c1 = 2 AND c5 IS INFINITE;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 2 AND c5 IS NOT INFINITE;
 c1 |    c5     
----+-----------
  2 | 1.79E+100
(1 row)

SELECT c1, c5 FROM tnf WHERE c1 = 3 AND c5 IS NAN;  -- error: overflow
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c1, c5 FROM tnf WHERE c1 = 3 AND c5 IS NOT NAN;  -- error: overflow
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c1, c5 FROM tnf WHERE c1 = 3 AND c5 IS INFINITE;  -- error: overflow
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c1, c5 FROM tnf WHERE c1 = 3 AND c5 IS NOT INFINITE;  -- error: overflow
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c1, c5 FROM tnf WHERE c1 = 4 AND c5 IS NAN;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 4 AND c5 IS NOT NAN;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 4 AND c5 IS INFINITE;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 4 AND c5 IS NOT INFINITE;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 5 AND c5 IS NAN; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
SELECT c1, c5 FROM tnf WHERE c1 = 5 AND c5 IS NOT NAN; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
SELECT c1, c5 FROM tnf WHERE c1 = 5 AND c5 IS INFINITE; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
SELECT c1, c5 FROM tnf WHERE c1 = 5 AND c5 IS NOT INFINITE; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
SELECT c1, c5 FROM tnf WHERE c1 = 6 AND c5 IS NAN; -- error: invalid number
ERROR:  invalid input for IS [NOT] NAN
SELECT c1, c5 FROM tnf WHERE c1 = 6 AND c5 IS NOT NAN; -- error: invalid number
ERROR:  invalid input for IS [NOT] NAN
SELECT c1, c5 FROM tnf WHERE c1 = 6 AND c5 IS INFINITE; -- error: invalid number
ERROR:  invalid input for IS [NOT] INFINITE
SELECT c1, c5 FROM tnf WHERE c1 = 6 AND c5 IS NOT INFINITE; -- error: invalid number
ERROR:  invalid input for IS [NOT] INFINITE
-- all error: can't cast timestamp to double precision
SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NAN; 
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NAN; 
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NOT INFINITE;
                                                ^
SELECT c2 IS NAN, c2 IS NOT NAN, c2 IS INFINITE, c2 IS NOT INFINITE FROM tnf ORDER BY c1;
 ?column? | ?column? | ?column? | ?column? 
----------+----------+----------+----------
 f        | t        | f        | t
 f        | t        | f        | t
 f        | t        | f        | t
          |          |          | 
 f        | t        | f        | t
 f        | t        | f        | t
(6 rows)

SELECT c3 IS NAN, c3 IS NOT NAN, c3 IS INFINITE, c3 IS NOT INFINITE FROM tnf ORDER BY c1;
 ?column? | ?column? | ?column? | ?column? 
----------+----------+----------+----------
 f        | t        | f        | t
 f        | t        | f        | t
 f        | t        | f        | t
          |          |          | 
 t        | f        | f        | t
 f        | t        | t        | f
(6 rows)

SELECT c4 IS NAN, c4 IS NOT NAN, c4 IS INFINITE, c4 IS NOT INFINITE FROM tnf ORDER BY c1;
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c5 IS NAN, c5 IS NOT NAN, c5 IS INFINITE, c5 IS NOT INFINITE FROM tnf ORDER BY c1;
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c6 IS NAN, c6 IS NOT NAN, c6 IS INFINITE, c6 IS NOT INFINITE FROM tnf ORDER BY c1;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c6 IS NAN, c6 IS NOT NAN, c6 IS INFINITE, c6 IS NOT I...
               ^
-- not
SELECT c1, c3, NOT(c3 IS NOT NAN), NOT(c3 IS NAN) FROM tnf ORDER BY c1;
 c1 |     c3     | ?column? | ?column? 
----+------------+----------+----------
  1 |    100.008 | f        | t
  2 | -1.79e+100 | f        | t
  3 |  1.79e+100 | f        | t
  4 |            |          | 
  5 |        NaN | t        | f
  6 |   Infinity | f        | t
(6 rows)

SELECT c1, c3, NOT(c3 IS NOT INFINITE), NOT(c3 IS INFINITE) FROM tnf ORDER BY c1;
 c1 |     c3     | ?column? | ?column? 
----+------------+----------+----------
  1 |    100.008 | f        | t
  2 | -1.79e+100 | f        | t
  3 |  1.79e+100 | f        | t
  4 |            |          | 
  5 |        NaN | f        | t
  6 |   Infinity | t        | f
(6 rows)

-- collation
SELECT c1, c2, c3, c4, c5 FROM tnf ORDER BY (c3 IS NAN);
 c1 |     c2     |     c3     |            c4             |       c5       
----+------------+------------+---------------------------+----------------
  1 |      10000 |    100.008 | 1234.5679                 | 987654321
  2 | -922337203 | -1.79e+100 | -1.79E+100                | 1.79E+100
  3 |  922337203 |  1.79e+100 | 9,223,372,036,854,775,807 | 1.79E+400
  6 |       3140 |   Infinity | NaN                       | Inf
  5 |          0 |        NaN | tonight                   | 12.34yesterday
  4 |            |            |                           | 
(6 rows)

SELECT (1 + 1) IS NAN;
 ?column? 
----------
 f
(1 row)

SELECT (c3 + 1) IS NAN FROM tnf;
 ?column? 
----------
 f
 f
 f
 
 t
 f
(6 rows)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE (c3 + 1) IS NOT NAN;
 c1 |     c2     |     c3     |            c4             |    c5     
----+------------+------------+---------------------------+-----------
  1 |      10000 |    100.008 | 1234.5679                 | 987654321
  2 | -922337203 | -1.79e+100 | -1.79E+100                | 1.79E+100
  3 |  922337203 |  1.79e+100 | 9,223,372,036,854,775,807 | 1.79E+400
  6 |       3140 |   Infinity | NaN                       | Inf
(4 rows)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE (c4 + 1) IS NOT NAN; -- error
ERROR:  invalid input syntax for type bigint: "1234.5679"
SELECT (SELECT c3 FROM tnf WHERE c1 = 3) IS NAN;
 ?column? 
----------
 f
(1 row)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE (SELECT c3 FROM tnf WHERE c1 = 5) IS nan;
 c1 |     c2     |     c3     |            c4             |       c5       
----+------------+------------+---------------------------+----------------
  1 |      10000 |    100.008 | 1234.5679                 | 987654321
  2 | -922337203 | -1.79e+100 | -1.79E+100                | 1.79E+100
  3 |  922337203 |  1.79e+100 | 9,223,372,036,854,775,807 | 1.79E+400
  4 |            |            |                           | 
  5 |          0 |        NaN | tonight                   | 12.34yesterday
  6 |       3140 |   Infinity | NaN                       | Inf
(6 rows)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE c1 IN (1, 2, 4, 5) AND c3 IS NAN;
 c1 | c2 | c3  |   c4    |       c5       
----+----+-----+---------+----------------
  5 |  0 | NaN | tonight | 12.34yesterday
(1 row)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE c1 IN (1, 2) AND c4 IS NAN;
 c1 | c2 | c3 | c4 | c5 
----+----+----+----+----
(0 rows)

-- test enable_expr_fusion
set enable_expr_fusion=on;
SELECT c1, c2 FROM tnf WHERE c1 = 1 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 1 AND c2 IS NOT NAN;
 c1 |  c2   
----+-------
  1 | 10000
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 1 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 1 AND c2 IS NOT INFINITE;
 c1 |  c2   
----+-------
  1 | 10000
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 2 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 2 AND c2 IS NOT NAN;
 c1 |     c2     
----+------------
  2 | -922337203
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 2 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 2 AND c2 IS NOT INFINITE;
 c1 |     c2     
----+------------
  2 | -922337203
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 3 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 3 AND c2 IS NOT NAN;
 c1 |    c2     
----+-----------
  3 | 922337203
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 3 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 3 AND c2 IS NOT INFINITE;
 c1 |    c2     
----+-----------
  3 | 922337203
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 4 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 4 AND c2 IS NOT NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 4 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 4 AND c2 IS NOT INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 5 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 5 AND c2 IS NOT NAN;
 c1 | c2 
----+----
  5 |  0
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 5 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 5 AND c2 IS NOT INFINITE;
 c1 | c2 
----+----
  5 |  0
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 6 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 6 AND c2 IS NOT NAN;
 c1 |  c2  
----+------
  6 | 3140
(1 row)

SELECT c1, c2 FROM tnf WHERE c1 = 6 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT c1, c2 FROM tnf WHERE c1 = 6 AND c2 IS NOT INFINITE;
 c1 |  c2  
----+------
  6 | 3140
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 1 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 1 AND c3 IS NOT NAN;
 c1 |   c3    
----+---------
  1 | 100.008
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 1 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 1 AND c3 IS NOT INFINITE;
 c1 |   c3    
----+---------
  1 | 100.008
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 2 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 2 AND c3 IS NOT NAN;
 c1 |     c3     
----+------------
  2 | -1.79e+100
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 2 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 2 AND c3 IS NOT INFINITE;
 c1 |     c3     
----+------------
  2 | -1.79e+100
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 3 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 3 AND c3 IS NOT NAN;
 c1 |    c3     
----+-----------
  3 | 1.79e+100
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 3 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 3 AND c3 IS NOT INFINITE;
 c1 |    c3     
----+-----------
  3 | 1.79e+100
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 4 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 4 AND c3 IS NOT NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 4 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 4 AND c3 IS NOT INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 5 AND c3 IS NAN;
 c1 | c3  
----+-----
  5 | NaN
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 5 AND c3 IS NOT NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 5 AND c3 IS INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 5 AND c3 IS NOT INFINITE;
 c1 | c3  
----+-----
  5 | NaN
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 6 AND c3 IS NAN;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c3 FROM tnf WHERE c1 = 6 AND c3 IS NOT NAN;
 c1 |    c3    
----+----------
  6 | Infinity
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 6 AND c3 IS INFINITE;
 c1 |    c3    
----+----------
  6 | Infinity
(1 row)

SELECT c1, c3 FROM tnf WHERE c1 = 6 AND c3 IS NOT INFINITE;
 c1 | c3 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 1 AND c4 IS NAN;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 1 AND c4 IS NOT NAN;
 c1 |    c4     
----+-----------
  1 | 1234.5679
(1 row)

SELECT c1, c4 FROM tnf WHERE c1 = 1 AND c4 IS INFINITE;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 1 AND c4 IS NOT INFINITE;
 c1 |    c4     
----+-----------
  1 | 1234.5679
(1 row)

SELECT c1, c4 FROM tnf WHERE c1 = 2 AND c4 IS NAN;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 2 AND c4 IS NOT NAN;
 c1 |     c4     
----+------------
  2 | -1.79E+100
(1 row)

SELECT c1, c4 FROM tnf WHERE c1 = 2 AND c4 IS INFINITE;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 2 AND c4 IS NOT INFINITE;
 c1 |     c4     
----+------------
  2 | -1.79E+100
(1 row)

SELECT c1, c4 FROM tnf WHERE c1 = 3 AND c4 IS NAN;  -- error: invalid number
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c1, c4 FROM tnf WHERE c1 = 3 AND c4 IS NOT NAN;  -- error: invalid number
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c1, c4 FROM tnf WHERE c1 = 3 AND c4 IS INFINITE;  -- error: invalid number
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c1, c4 FROM tnf WHERE c1 = 3 AND c4 IS NOT INFINITE;  -- error: invalid number
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c1, c4 FROM tnf WHERE c1 = 4 AND c4 IS NAN;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 4 AND c4 IS NOT NAN;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 4 AND c4 IS INFINITE;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 4 AND c4 IS NOT INFINITE;
 c1 | c4 
----+----
(0 rows)

SELECT c1, c4 FROM tnf WHERE c1 = 5 AND c4 IS NAN; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "tonight"
SELECT c1, c4 FROM tnf WHERE c1 = 5 AND c4 IS NOT NAN; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "tonight"
SELECT c1, c4 FROM tnf WHERE c1 = 5 AND c4 IS INFINITE; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "tonight"
SELECT c1, c4 FROM tnf WHERE c1 = 5 AND c4 IS NOT INFINITE; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "tonight"
SELECT c1, c4 FROM tnf WHERE c1 = 6 AND c4 IS NAN; -- error: invalid number
ERROR:  invalid input for IS [NOT] NAN
SELECT c1, c4 FROM tnf WHERE c1 = 6 AND c4 IS NOT NAN; -- error: invalid number
ERROR:  invalid input for IS [NOT] NAN
SELECT c1, c4 FROM tnf WHERE c1 = 6 AND c4 IS INFINITE; -- error: invalid number
ERROR:  invalid input for IS [NOT] INFINITE
SELECT c1, c4 FROM tnf WHERE c1 = 6 AND c4 IS NOT INFINITE; -- error: invalid number
ERROR:  invalid input for IS [NOT] INFINITE
SELECT c1, c5 FROM tnf WHERE c1 = 1 AND c5 IS NAN;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 1 AND c5 IS NOT NAN;
 c1 |    c5     
----+-----------
  1 | 987654321
(1 row)

SELECT c1, c5 FROM tnf WHERE c1 = 1 AND c5 IS INFINITE;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 1 AND c5 IS NOT INFINITE;
 c1 |    c5     
----+-----------
  1 | 987654321
(1 row)

SELECT c1, c5 FROM tnf WHERE c1 = 2 AND c5 IS NAN;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 2 AND c5 IS NOT NAN;
 c1 |    c5     
----+-----------
  2 | 1.79E+100
(1 row)

SELECT c1, c5 FROM tnf WHERE c1 = 2 AND c5 IS INFINITE;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 2 AND c5 IS NOT INFINITE;
 c1 |    c5     
----+-----------
  2 | 1.79E+100
(1 row)

SELECT c1, c5 FROM tnf WHERE c1 = 3 AND c5 IS NAN;  -- error: overflow
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c1, c5 FROM tnf WHERE c1 = 3 AND c5 IS NOT NAN;  -- error: overflow
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c1, c5 FROM tnf WHERE c1 = 3 AND c5 IS INFINITE;  -- error: overflow
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c1, c5 FROM tnf WHERE c1 = 3 AND c5 IS NOT INFINITE;  -- error: overflow
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c1, c5 FROM tnf WHERE c1 = 4 AND c5 IS NAN;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 4 AND c5 IS NOT NAN;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 4 AND c5 IS INFINITE;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 4 AND c5 IS NOT INFINITE;
 c1 | c5 
----+----
(0 rows)

SELECT c1, c5 FROM tnf WHERE c1 = 5 AND c5 IS NAN; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
SELECT c1, c5 FROM tnf WHERE c1 = 5 AND c5 IS NOT NAN; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
SELECT c1, c5 FROM tnf WHERE c1 = 5 AND c5 IS INFINITE; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
SELECT c1, c5 FROM tnf WHERE c1 = 5 AND c5 IS NOT INFINITE; -- error: invalid number
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
SELECT c1, c5 FROM tnf WHERE c1 = 6 AND c5 IS NAN; -- error: invalid number
ERROR:  invalid input for IS [NOT] NAN
SELECT c1, c5 FROM tnf WHERE c1 = 6 AND c5 IS NOT NAN; -- error: invalid number
ERROR:  invalid input for IS [NOT] NAN
SELECT c1, c5 FROM tnf WHERE c1 = 6 AND c5 IS INFINITE; -- error: invalid number
ERROR:  invalid input for IS [NOT] INFINITE
SELECT c1, c5 FROM tnf WHERE c1 = 6 AND c5 IS NOT INFINITE; -- error: invalid number
ERROR:  invalid input for IS [NOT] INFINITE
-- all error: can't cast timestamp to double precision
SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NAN; 
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 1 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 2 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NAN; 
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 3 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 4 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 5 AND c6 IS NOT INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NOT NAN;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NOT NAN;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS INFINITE;
                                                ^
SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NOT INFINITE;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c1, c6 FROM tnf WHERE c1 = 6 AND c6 IS NOT INFINITE;
                                                ^
SELECT c2 IS NAN, c2 IS NOT NAN, c2 IS INFINITE, c2 IS NOT INFINITE FROM tnf ORDER BY c1;
 ?column? | ?column? | ?column? | ?column? 
----------+----------+----------+----------
 f        | t        | f        | t
 f        | t        | f        | t
 f        | t        | f        | t
          |          |          | 
 f        | t        | f        | t
 f        | t        | f        | t
(6 rows)

SELECT c3 IS NAN, c3 IS NOT NAN, c3 IS INFINITE, c3 IS NOT INFINITE FROM tnf ORDER BY c1;
 ?column? | ?column? | ?column? | ?column? 
----------+----------+----------+----------
 f        | t        | f        | t
 f        | t        | f        | t
 f        | t        | f        | t
          |          |          | 
 t        | f        | f        | t
 f        | t        | t        | f
(6 rows)

SELECT c4 IS NAN, c4 IS NOT NAN, c4 IS INFINITE, c4 IS NOT INFINITE FROM tnf ORDER BY c1;
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
SELECT c5 IS NAN, c5 IS NOT NAN, c5 IS INFINITE, c5 IS NOT INFINITE FROM tnf ORDER BY c1;
ERROR:  "1.79E+400" is out of range for type double precision
SELECT c6 IS NAN, c6 IS NOT NAN, c6 IS INFINITE, c6 IS NOT INFINITE FROM tnf ORDER BY c1;
ERROR:  cannot cast type timestamp without time zone to double precision
LINE 1: SELECT c6 IS NAN, c6 IS NOT NAN, c6 IS INFINITE, c6 IS NOT I...
               ^
-- not
SELECT c1, c3, NOT(c3 IS NOT NAN), NOT(c3 IS NAN) FROM tnf ORDER BY c1;
 c1 |     c3     | ?column? | ?column? 
----+------------+----------+----------
  1 |    100.008 | f        | t
  2 | -1.79e+100 | f        | t
  3 |  1.79e+100 | f        | t
  4 |            |          | 
  5 |        NaN | t        | f
  6 |   Infinity | f        | t
(6 rows)

SELECT c1, c3, NOT(c3 IS NOT INFINITE), NOT(c3 IS INFINITE) FROM tnf ORDER BY c1;
 c1 |     c3     | ?column? | ?column? 
----+------------+----------+----------
  1 |    100.008 | f        | t
  2 | -1.79e+100 | f        | t
  3 |  1.79e+100 | f        | t
  4 |            |          | 
  5 |        NaN | f        | t
  6 |   Infinity | t        | f
(6 rows)

-- collation
SELECT c1, c2, c3, c4, c5 FROM tnf ORDER BY (c3 IS NAN);
 c1 |     c2     |     c3     |            c4             |       c5       
----+------------+------------+---------------------------+----------------
  1 |      10000 |    100.008 | 1234.5679                 | 987654321
  2 | -922337203 | -1.79e+100 | -1.79E+100                | 1.79E+100
  3 |  922337203 |  1.79e+100 | 9,223,372,036,854,775,807 | 1.79E+400
  6 |       3140 |   Infinity | NaN                       | Inf
  5 |          0 |        NaN | tonight                   | 12.34yesterday
  4 |            |            |                           | 
(6 rows)

SELECT (1 + 1) IS NAN;
 ?column? 
----------
 f
(1 row)

SELECT (c3 + 1) IS NAN FROM tnf;
 ?column? 
----------
 f
 f
 f
 
 t
 f
(6 rows)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE (c3 + 1) IS NOT NAN;
 c1 |     c2     |     c3     |            c4             |    c5     
----+------------+------------+---------------------------+-----------
  1 |      10000 |    100.008 | 1234.5679                 | 987654321
  2 | -922337203 | -1.79e+100 | -1.79E+100                | 1.79E+100
  3 |  922337203 |  1.79e+100 | 9,223,372,036,854,775,807 | 1.79E+400
  6 |       3140 |   Infinity | NaN                       | Inf
(4 rows)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE (c4 + 1) IS NOT NAN; -- error
ERROR:  invalid input syntax for type bigint: "1234.5679"
SELECT (SELECT c3 FROM tnf WHERE c1 = 3) IS NAN;
 ?column? 
----------
 f
(1 row)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE (SELECT c3 FROM tnf WHERE c1 = 5) IS nan;
 c1 |     c2     |     c3     |            c4             |       c5       
----+------------+------------+---------------------------+----------------
  1 |      10000 |    100.008 | 1234.5679                 | 987654321
  2 | -922337203 | -1.79e+100 | -1.79E+100                | 1.79E+100
  3 |  922337203 |  1.79e+100 | 9,223,372,036,854,775,807 | 1.79E+400
  4 |            |            |                           | 
  5 |          0 |        NaN | tonight                   | 12.34yesterday
  6 |       3140 |   Infinity | NaN                       | Inf
(6 rows)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE c1 IN (1, 2, 4, 5) AND c3 IS NAN;
 c1 | c2 | c3  |   c4    |       c5       
----+----+-----+---------+----------------
  5 |  0 | NaN | tonight | 12.34yesterday
(1 row)

SELECT c1, c2, c3, c4, c5 FROM tnf WHERE c1 IN (1, 2) AND c4 IS NAN;
 c1 | c2 | c3 | c4 | c5 
----+----+----+----+----
(0 rows)

set enable_expr_fusion=off;
-- parse view
CREATE VIEW v_t AS SELECT c3 IS NAN FROM tnf ORDER BY c1;
CREATE VIEW v_t2 AS SELECT c4 IS NOT NAN FROM tnf ORDER BY c1;
CREATE VIEW v_t3 AS SELECT c3 IS INFINITE FROM tnf ORDER BY c1;
CREATE VIEW v_t4 AS SELECT c4 IS NOT INFINITE FROM tnf ORDER BY c1;
\d+ v_t
                  View "expr_nan.v_t"
  Column  |  Type   | Modifiers | Storage | Description 
----------+---------+-----------+---------+-------------
 ?column? | boolean |           | plain   | 
View definition:
 SELECT tnf.c3 IS NAN AS "?column?"
   FROM tnf
  ORDER BY tnf.c1;

\d+ v_t2
                  View "expr_nan.v_t2"
  Column  |  Type   | Modifiers | Storage | Description 
----------+---------+-----------+---------+-------------
 ?column? | boolean |           | plain   | 
View definition:
 SELECT tnf.c4::double precision IS NOT NAN AS "?column?"
   FROM tnf
  ORDER BY tnf.c1;

\d+ v_t3
                  View "expr_nan.v_t3"
  Column  |  Type   | Modifiers | Storage | Description 
----------+---------+-----------+---------+-------------
 ?column? | boolean |           | plain   | 
View definition:
 SELECT tnf.c3 IS INFINITE AS "?column?"
   FROM tnf
  ORDER BY tnf.c1;

\d+ v_t4
                  View "expr_nan.v_t4"
  Column  |  Type   | Modifiers | Storage | Description 
----------+---------+-----------+---------+-------------
 ?column? | boolean |           | plain   | 
View definition:
 SELECT tnf.c4::double precision IS NOT INFINITE AS "?column?"
   FROM tnf
  ORDER BY tnf.c1;

-- test where condition order
CREATE TABLE t_m (c1 int, c2 float8);
CREATE TABLE t_txt (c1 int, c2 text);
CREATE OR REPLACE FUNCTION batch_insert()
RETURNS int AS $$
DECLARE
	i INT;
	start INT;
    row_count INT := 2000;
BEGIN
	SELECT COUNT(*) INTO start FROM t_m;
    FOR i IN SELECT generate_series(1, row_count) LOOP
        INSERT INTO t_m VALUES (start + i, pg_catalog.random() * i);
    END LOOP;
	
	RETURN row_count;
END;
$$ LANGUAGE plpgsql;
SELECT batch_insert();
 batch_insert 
--------------
         2000
(1 row)

SELECT batch_insert();
 batch_insert 
--------------
         2000
(1 row)

UPDATE t_m set c2 = CAST('NAN' as float8) where c1 = 1000;
UPDATE t_m set c2 = CAST('INF' as float8) where c1 = 1001;
UPDATE t_m set c2 = NULL where c1 = 1002;
INSERT INTO t_txt SELECT c1, c2 FROM t_m;
-- without ANALYZE
SELECT * FROM t_m WHERE c2 IS NAN;
  c1  | c2  
------+-----
 1000 | NaN
(1 row)

SELECT * FROM t_m WHERE c2 IS INFINITE;
  c1  |    c2    
------+----------
 1001 | Infinity
(1 row)

SELECT * FROM t_txt WHERE c2 IS NAN; -- error
ERROR:  invalid input for IS [NOT] NAN
SELECT * FROM t_txt WHERE c2 IS INFINITE; -- error
ERROR:  invalid input for IS [NOT] INFINITE
-- test other condition combine with IS [NOT] NAN|INFINITE
SELECT * FROM t_txt WHERE c1 < 900 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 < 900 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <= 900 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <= 900 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 > 1010 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 > 1010 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 >= 1010 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 >= 1010 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <> 1000 AND c1 <> 1001 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <> 1000 AND c1 <> 1001 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <> 1000 AND c2 IS NAN; -- error
ERROR:  invalid input for IS [NOT] NAN
SELECT * FROM t_txt WHERE c1 <> 1000 AND c2 IS INFINITE; -- error
ERROR:  invalid input for IS [NOT] INFINITE
SELECT * FROM t_txt WHERE c1 BETWEEN 500 AND 600 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 BETWEEN 500 AND 600 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 = 999 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 = 999 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c2 LIKE '12%' AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c2 LIKE '12%' AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 IN (10) AND C2 IS NAN; -- ok
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 IN (10, 20) AND C2 IS NAN; -- ok
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 IN (10, 20, 30) AND C2 IS NAN; -- error
ERROR:  invalid input for IS [NOT] NAN
SELECT * FROM t_txt WHERE c1 IN (10, 20, 30, 40, 60, 100, 120, 180) AND C2 IS NAN; -- error
ERROR:  invalid input for IS [NOT] NAN
-- with ANALYZE
ANALYZE t_m;
ANALYZE t_txt;
SELECT * FROM t_txt WHERE c1 < 900 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 < 900 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <= 900 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <= 900 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 > 1010 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 > 1010 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 >= 1010 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 >= 1010 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <> 1000 AND c1 <> 1001 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <> 1000 AND c1 <> 1001 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 <> 1000 AND c2 IS NAN; -- error
ERROR:  invalid input for IS [NOT] NAN
SELECT * FROM t_txt WHERE c1 <> 1000 AND c2 IS INFINITE; -- error
ERROR:  invalid input for IS [NOT] INFINITE
SELECT * FROM t_txt WHERE c1 BETWEEN 500 AND 600 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 BETWEEN 500 AND 600 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 = 999 AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 = 999 AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c2 LIKE '12%' AND c2 IS NAN;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c2 LIKE '12%' AND c2 IS INFINITE;
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 IN (10) AND C2 IS NAN; -- ok
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 IN (10, 20) AND C2 IS NAN; -- ok
 c1 | c2 
----+----
(0 rows)

SELECT * FROM t_txt WHERE c1 IN (10, 20, 30) AND C2 IS NAN; -- error
ERROR:  invalid input for IS [NOT] NAN
SELECT * FROM t_txt WHERE c1 IN (10, 20, 30, 40, 60, 100, 120, 180) AND C2 IS NAN; -- error
ERROR:  invalid input for IS [NOT] NAN
-- PBE
CREATE TABLE tnf2 (c1 int, func_name text, res boolean);
PREPARE isnan_text(int, text) AS INSERT INTO tnf2 VALUES 
($1 * 2 - 1, concat($2, ' IS NAN'), $2 IS NAN),
($1 * 2, concat($2, ' IS NOT NAN'), $2 IS NOT NAN);
EXECUTE isnan_text(1, '987654321');
EXECUTE isnan_text(2, '1.79E+100');
EXECUTE isnan_text(3, '9,223,372,036,854,775,807');
ERROR:  invalid input syntax for type double precision: "9,223,372,036,854,775,807"
EXECUTE isnan_text(4, '1.79E+400');
ERROR:  "1.79E+400" is out of range for type double precision
EXECUTE isnan_text(5, '12.34yesterday');
ERROR:  invalid input syntax for type double precision: "12.34yesterday"
EXECUTE isnan_text(6, 'tonight');
ERROR:  invalid input syntax for type double precision: "tonight"
EXECUTE isnan_text(7, 'Nan');
ERROR:  invalid input for IS [NOT] NAN
EXECUTE isnan_text(8, 'Inf');
EXECUTE isnan_text(9, 'Infinite');
ERROR:  invalid input syntax for type double precision: "Infinite"
PREPARE isnan_num(int, float8) AS INSERT INTO tnf2 VALUES 
($1 * 2 - 1, concat($2, ' IS NAN'), $2 IS NAN),
($1 * 2, concat($2, ' IS NOT NAN'), $2 IS NOT NAN);
EXECUTE isnan_num(10, -9223372036854775808);
EXECUTE isnan_num(11, 1.23E-100);
EXECUTE isnan_num(12, -1.79E+100);
EXECUTE isnan_num(13, 1.79E+100);
EXECUTE isnan_num(14, 1.79E+400);
ERROR:  number overflow at or near "1.79E+400"
LINE 1: EXECUTE isnan_num(14, 1.79E+400);
                              ^
EXECUTE isnan_num(15, CAST('NaN' as float8));
EXECUTE isnan_num(16, CAST('Inf' as float8));
SELECT * FROM tnf2 ORDER BY c1;
 c1 |            func_name             | res 
----+----------------------------------+-----
  1 | 987654321 IS NAN                 | f
  2 | 987654321 IS NOT NAN             | t
  3 | 1.79E+100 IS NAN                 | f
  4 | 1.79E+100 IS NOT NAN             | t
 15 | Inf IS NAN                       | f
 16 | Inf IS NOT NAN                   | t
 19 | -9.22337203685478e+18 IS NAN     | f
 20 | -9.22337203685478e+18 IS NOT NAN | t
 21 | 1.23e-100 IS NAN                 | f
 22 | 1.23e-100 IS NOT NAN             | t
 23 | -1.79e+100 IS NAN                | f
 24 | -1.79e+100 IS NOT NAN            | t
 25 | 1.79e+100 IS NAN                 | f
 26 | 1.79e+100 IS NOT NAN             | t
 29 | NaN IS NAN                       | t
 30 | NaN IS NOT NAN                   | f
 31 | Infinity IS NAN                  | f
 32 | Infinity IS NOT NAN              | t
(18 rows)

drop view v_t;
drop view v_t2;
drop view v_t3;
drop view v_t4;
drop table tnf;
drop table tnf2;
drop table t_m;
drop table t_txt;
drop function batch_insert;
drop schema if exists expr_nan cascade;

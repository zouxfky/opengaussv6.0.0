drop database if exists mysql_test_resignal;
NOTICE:  database "mysql_test_resignal" does not exist, skipping
create database mysql_test_resignal dbcompatibility = 'B';
\c mysql_test_resignal
-- parse error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        signal SQLSTATE VALUE 12345;
    END;
    DROP TABLE t1;
END;
/
ERROR:  syntax error, the expected value is a string. at or near "12345"
LINE 4:         signal SQLSTATE VALUE 12345;
                                      ^
QUERY:   DECLARE BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        signal SQLSTATE VALUE 12345;
    END;
    DROP TABLE t1;
END
-- parse error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE '12012' value MYSQL_ERRNO = 1;
    END;
    DROP TABLE t1;
END;
/
ERROR:  invalid keyword at or near "value"
LINE 4:         resignal SQLSTATE '12012' value MYSQL_ERRNO = 1;
                                          ^
QUERY:   DECLARE BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE '12012' value MYSQL_ERRNO = 1;
    END;
    DROP TABLE t1;
END
-- parse error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE '12012' value MYSQL_ERRNO = 1;
    END;
    DROP TABLE t1;
END;
/
ERROR:  invalid keyword at or near "value"
LINE 4:         resignal SQLSTATE '12012' value MYSQL_ERRNO = 1;
                                          ^
QUERY:   DECLARE BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE '12012' value MYSQL_ERRNO = 1;
    END;
    DROP TABLE t1;
END
-- parse error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE;
    END;
    DROP TABLE t1;
END;
/
ERROR:  unexpected end of function definition at or near ";"
LINE 4:         resignal SQLSTATE;
                                 ^
QUERY:   DECLARE BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE;
    END;
    DROP TABLE t1;
END
-- parse error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal 12345;
    END;
    DROP TABLE t1;
END;
/
ERROR:  syntax error, the condition name is expected. at or near "12345"
LINE 4:         resignal 12345;
                         ^
QUERY:   DECLARE BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal 12345;
    END;
    DROP TABLE t1;
END
-- parse error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE '1234';
    END;
    DROP TABLE t1;
END;
/
ERROR:  bad SQLSTATE '1234'
CONTEXT:  compilation of PL/pgSQL function "p1" near line 4
-- 1. resignal without handler
-- 1.1 signal without signal_information_item and SQLSTATE
-- exec error
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    resignal;
END;
/
call p1();
ERROR:  RESIGNAL when handler not active
CONTEXT:  PL/pgSQL function p1() line 2 at RESIGNAL
CREATE OR REPLACE PROCEDURE p1(a int) IS
BEGIN
    if a = 0 then
        resignal;
    else
        RAISE info 'value is %', a;
    end if;
END;
/
-- error
call p1(0);
ERROR:  RESIGNAL when handler not active
CONTEXT:  PL/pgSQL function p1(integer) line 3 at RESIGNAL
-- success
call p1(1);
INFO:  value is 1
 p1 
----
 
(1 row)

-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'MESSAGE_TEXT' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET MYSQL_ERRNO = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'MYSQL_ERRNO' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET CLASS_ORIGIN = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'CLASS_ORIGIN' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET SUBCLASS_ORIGIN = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'SUBCLASS_ORIGIN' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET CONSTRAINT_NAME = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'CONSTRAINT_NAME' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET CONSTRAINT_CATALOG = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'CONSTRAINT_CATALOG' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET CONSTRAINT_SCHEMA = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'CONSTRAINT_SCHEMA' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET CATALOG_NAME = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'CATALOG_NAME' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET SCHEMA_NAME = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'SCHEMA_NAME' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET TABLE_NAME = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'TABLE_NAME' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET COLUMN_NAME = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'COLUMN_NAME' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET CURSOR_NAME = NULL;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  Variable 'CURSOR_NAME' can't be set to the value of 'NULL'
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
-- 2. resignal with handler
-- 2.1 resignal alone and continue handler
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLWARNING
    BEGIN
        resignal;
    END;
    signal SQLSTATE '01111';
END;
/
call p1();
WARNING:  Unhandled user-defined warning condition
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
 p1 
----
 
(1 row)

show warnings;
  level  | code  |                 message                  
---------+-------+------------------------------------------
 Warning | 01000 | Unhandled user-defined warning condition
(1 row)

CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR NOT FOUND
    BEGIN
        resignal;
    END;
    signal SQLSTATE '02222';
END;
/
call p1();
ERROR:  Unhandled user-defined not found condition
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |                  message                   
-------+-------+--------------------------------------------
 Error | 02000 | Unhandled user-defined not found condition
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE err_exception CONDITION FOR SQLSTATE '42P01';
    DECLARE CONTINUE HANDLER FOR err_exception
    BEGIN
        resignal;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p1() line 5 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
create table t1(a int);
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE err_exception CONDITION FOR 42703;
    DECLARE CONTINUE HANDLER FOR err_exception
    BEGIN
        resignal;
    END;
    select f1 from t1 into a;
END;
/
call p1();
ERROR:  function "p1" with 0 parameters doesn't exist 
show warnings;
 level | code  |                    message                     
-------+-------+------------------------------------------------
 Error | 42883 | function "p1" with 0 parameters doesn't exist 
(1 row)

DROP TABLE IF EXISTS t1;
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code |       message        
-------+------+----------------------
 Error | 1111 | table is not defined
(1 row)

CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '01000' signal SQLSTATE '02000' SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    signal SQLSTATE '01000';
END;
/
call p1();
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 2 at SIGNAL
show warnings;
 level | code |       message        
-------+------+----------------------
 Error | 1111 | table is not defined
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    DROP TABLE t1;
    select 1 into a;
END;
/
call p1(0);
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code |       message        
-------+------+----------------------
 Error | 1111 | table is not defined
(1 row)

CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR NOT FOUND
    BEGIN
        resignal SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    signal SQLSTATE '02222';
    select 1 into a;
END;
/
call p1(0);
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code |       message        
-------+------+----------------------
 Error | 1111 | table is not defined
(1 row)

CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE EXIT HANDLER FOR NOT FOUND
    BEGIN
        resignal SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    signal SQLSTATE '02222';
    select 1 into a;
END;
/
call p1(0);
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code |       message        
-------+------+----------------------
 Error | 1111 | table is not defined
(1 row)

CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLWARNING
    BEGIN
        resignal SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    signal SQLSTATE '01111';
    select 1 into a;
END;
/
call p1(0);
WARNING:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLWARNING
    BEGIN
        resignal SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    signal SQLSTATE '01111';
    select 1 into a;
END;
/
call p1(0);
WARNING:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
 a 
---
  
(1 row)

show warnings;
  level  | code |       message        
---------+------+----------------------
 Warning | 1111 | table is not defined
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '42P01' SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1111  | table is not defined
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = 'table is not defined';
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 03000 | table is not defined
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '22012';
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 03000 | table "t1" does not exist
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '42P01';
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 03000 | table "t1" does not exist
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
create table t1(a int);
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR 42703
    BEGIN
        resignal SQLSTATE '42P01' SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    SELECT f1 FROM t1 INTO a;
END;
/
call p1();
ERROR:  function "p1" with 0 parameters doesn't exist 
show warnings;
 level | code  |                    message                     
-------+-------+------------------------------------------------
 Error | 42883 | function "p1" with 0 parameters doesn't exist 
(1 row)

DROP TABLE IF EXISTS t1;
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE err_exception CONDITION FOR SQLSTATE '22012';
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal err_exception SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 5 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1111  | table is not defined
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
create table t1(a int);
-- parse error
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE err_exception CONDITION FOR 42703;
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal err_exception SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111;
    END;
    SELECT f1 FROM t1 INTO a;
END;
/
ERROR:  SIGNAL/RESIGNAL can only use a CONDITION defined with SQLSTATE
CONTEXT:  compilation of PL/pgSQL function "p1" near line 5
DROP TABLE IF EXISTS t1;
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1120;
    END;
    DROP TABLE t1;
    select 1 into a;
END;
/
call p1(0);
WARNING:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLSTATE '42P01'
    BEGIN
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1120;
    END;
    DROP TABLE t1;
    select 1 into a;
END;
/
call p1(0);
WARNING:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
 a 
---
  
(1 row)

show warnings;
  level  | code  |          message          
---------+-------+---------------------------
 Error   | 42P01 | table "t1" does not exist
 Warning | 1120  | table is not defined
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '42P01' 
    BEGIN
        resignal SQLSTATE '42P01' SET MESSAGE_TEXT = 'table is not defined', MYSQL_ERRNO = 1111, CLASS_ORIGIN = 'ISO 9075', SUBCLASS_ORIGIN = 'ISO 9075', CONSTRAINT_NAME = 'constraint_name',
        CONSTRAINT_CATALOG = 'constraint_catalog', CONSTRAINT_SCHEMA = 'constraint_schema', CATALOG_NAME = 'catalog_name', SCHEMA_NAME = 'schema_name', TABLE_NAME = 'table_name',
        COLUMN_NAME = 'column name', CURSOR_NAME = 'cursor name';
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  table is not defined
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1111  | table is not defined
(2 rows)

set b_format_behavior_compat_options = 'enable_set_variables';
set @message_text = 'exception error', @mysql_errno = 1120, @class_origin = 'ISO 9075', @subclass_origin = 'ISO 9075',
@constraint_name = 'constraint_name', @constraint_catalog = 'constraint_catalog', @constraint_schema = 'constraint_schema',
@catalog_name = 'catalog_name', @schema_name = 'schema_name', @table_name = 'table_name',
@column_name = 'column name', @cursor_name = 'cursor name';
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = @message_text, MYSQL_ERRNO = @mysql_errno, CLASS_ORIGIN = @class_origin,
                SUBCLASS_ORIGIN = @subclass_origin, CONSTRAINT_NAME = @constraint_name, CONSTRAINT_CATALOG = @constraint_catalog,
                CONSTRAINT_SCHEMA = @constraint_schema, CATALOG_NAME = @catalog_name, SCHEMA_NAME = @schema_name, TABLE_NAME = @table_name,
                COLUMN_NAME = @column_name, CURSOR_NAME = @cursor_name;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  exception error
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1120  | exception error
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = concat('exception ', 'error'), MYSQL_ERRNO = abs(-1120);
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  exception error
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1120  | exception error
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(message_text text, mysql_errno int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = message_text, MYSQL_ERRNO = mysql_errno;
    END;
    DROP TABLE t1;
END;
/
call p1('exception error', 1120);
ERROR:  exception error
CONTEXT:  PL/pgSQL function p1(text,integer) line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1120  | exception error
(2 rows)

call p1(concat('exception ', 'error'), abs(-1120));
ERROR:  exception error
CONTEXT:  PL/pgSQL function p1(text,integer) line 4 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1120  | exception error
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
DECLARE
    message_text text;
    mysql_errno int;
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = message_text, MYSQL_ERRNO = mysql_errno;
    select concat('exception ', 'error') into message_text;
    select abs(-1120) into mysql_errno;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  exception error
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1120  | exception error
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
DECLARE
    message_text text;
    mysql_errno int;
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = message_text, MYSQL_ERRNO = mysql_errno;
    message_text := 'exception error';
    mysql_errno := 1120;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  exception error
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1120  | exception error
(2 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE err_exception1 CONDITION FOR SQLSTATE '42P01';
    DECLARE err_exception2 CONDITION FOR SQLSTATE '22012';
    DECLARE CONTINUE HANDLER FOR err_exception1
        resignal err_exception2 SET MESSAGE_TEXT = 'the table is not exist', MYSQL_ERRNO = 1120;
    DROP TABLE t1;
    select 1 into a;
END;
/
call p1(0);
ERROR:  the table is not exist
CONTEXT:  PL/pgSQL function p1() line 5 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 1120  | the table is not exist
(2 rows)

-- error
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
create table t1(a int);
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE err_exception1 CONDITION FOR 42703;
    DECLARE err_exception2 CONDITION FOR 22012;
    DECLARE CONTINUE HANDLER FOR err_exception1
        resignal err_exception2 SET MESSAGE_TEXT = 'the table is not exist', MYSQL_ERRNO = 1120;
    select f1 from t1 into a;
    select 1 into a;
END;
/
ERROR:  SIGNAL/RESIGNAL can only use a CONDITION defined with SQLSTATE
CONTEXT:  compilation of PL/pgSQL function "p1" near line 5
DROP TABLE IF EXISTS t1;
create table t1(a int);
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE err_exception1 CONDITION FOR 42703;
    DECLARE err_exception2 CONDITION FOR SQLSTATE '22012';
    DECLARE CONTINUE HANDLER FOR err_exception1
        resignal err_exception2 SET MESSAGE_TEXT = 'the table is not exist', MYSQL_ERRNO = 1120;
    select f1 from t1 into a;
    select 1 into a;
END;
/
call p1(0);
ERROR:  the table is not exist
CONTEXT:  PL/pgSQL function p1() line 5 at RESIGNAL
show warnings;
 level | code  |          message           
-------+-------+----------------------------
 Error | 42703 | column "f1" does not exist
 Error | 1120  | the table is not exist
(2 rows)

-- throw handler when sqlstate = 01000 with signal/resignal statement
CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '01000'
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 1;
    signal SQLSTATE '01000';
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLSTATE '01000'
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 1;
    signal SQLSTATE '01000';
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 
(1 row)

show warnings;
  level  | code  |                 message                  
---------+-------+------------------------------------------
 Warning | 01000 | Unhandled user-defined warning condition
 Warning | 1     | this is warnings
(2 rows)

CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '01000'
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 1;
    signal SQLSTATE '01000';
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR 01000
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 2;
    signal SQLSTATE '01000' SET MYSQL_ERRNO = 2;
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR 01000
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 3;
    signal SQLSTATE '01000' SET MYSQL_ERRNO = 3;
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLWARNING
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 3;
    signal SQLSTATE '01000' SET MYSQL_ERRNO = 3;
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLWARNING
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 1;
    signal SQLSTATE '01000';
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLWARNING
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 65535;
    signal SQLSTATE '01000' SET MYSQL_ERRNO = 65535;
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE err_warnings1 CONDITION FOR 01000;
    DECLARE err_warnings2 CONDITION FOR SQLSTATE '01000';
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION, SQLSTATE '01000', SQLWARNING, err_warnings1, err_warnings2
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'this is warnings', MYSQL_ERRNO = 1;
    signal SQLSTATE '01000';
    select 1 into a;
END;
/
call p1(0);
WARNING:  this is warnings
CONTEXT:  PL/pgSQL function p1() line 5 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

DROP TABLE IF EXISTS hdfs_tbl_001;
NOTICE:  table "hdfs_tbl_001" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLSTATE '02002'
        resignal SQLSTATE '11220' SET MESSAGE_TEXT = 'this is not found error', MYSQL_ERRNO = 1120;
    CREATE TABLE hdfs_tbl_001(a int, b int) WITH(orientation = row, version = 0.12);
    SELECT 1 into a;
END;
/
call p1(0);
ERROR:  this is not found error
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
show warnings;
 level | code  |                            message                            
-------+-------+---------------------------------------------------------------
 Error | 02002 | It is not allowed to assign version option for non-dfs table.
 Error | 1120  | this is not found error
(2 rows)

DROP TABLE IF EXISTS hdfs_tbl_001;
NOTICE:  table "hdfs_tbl_001" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '02002'
        resignal SQLSTATE '11220' SET MESSAGE_TEXT = 'this is not found error', MYSQL_ERRNO = 1120;
    CREATE TABLE hdfs_tbl_001(a int, b int) WITH(orientation = row, version = 0.12);
    SELECT 1 into a;
END;
/
call p1(0);
ERROR:  this is not found error
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
show warnings;
 level | code  |                            message                            
-------+-------+---------------------------------------------------------------
 Error | 02002 | It is not allowed to assign version option for non-dfs table.
 Error | 1120  | this is not found error
(2 rows)

DROP TABLE IF EXISTS hdfs_tbl_001;
NOTICE:  table "hdfs_tbl_001" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLSTATE '02002'
        resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'this is not found error', MYSQL_ERRNO = 1120;
    CREATE TABLE hdfs_tbl_001(a int, b int) WITH(orientation = row, version = 0.12);
    SELECT 1 into a;
END;
/
call p1(0);
WARNING:  this is not found error
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 
(1 row)

show warnings;
  level  | code  |                            message                            
---------+-------+---------------------------------------------------------------
 Error   | 02002 | It is not allowed to assign version option for non-dfs table.
 Warning | 1120  | this is not found error
(2 rows)

DROP TABLE IF EXISTS hdfs_tbl_001;
NOTICE:  table "hdfs_tbl_001" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out text) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLSTATE '02002'
        resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'this is not found error', MYSQL_ERRNO = 1120;
    CREATE TABLE hdfs_tbl_001(a int, b int) WITH(orientation = row, version = 0.12);
    SELECT 1 into a;
END;
/
call p1(0);
WARNING:  this is not found error
CONTEXT:  PL/pgSQL function p1() line 3 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

DROP TABLE IF EXISTS hdfs_tbl_001;
NOTICE:  table "hdfs_tbl_001" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE err_not_found CONDITION FOR 02002;
    DECLARE EXIT HANDLER FOR err_not_found
        resignal SQLSTATE '22012' SET MESSAGE_TEXT = 'this is not found error', MYSQL_ERRNO = 1120;
    CREATE TABLE hdfs_tbl_001(a int, b int) WITH(orientation = row, version = 0.12);
END;
/
call p1();
ERROR:  this is not found error
CONTEXT:  PL/pgSQL function p1() line 4 at RESIGNAL
show warnings;
 level | code  |                            message                            
-------+-------+---------------------------------------------------------------
 Error | 02002 | It is not allowed to assign version option for non-dfs table.
 Error | 1120  | this is not found error
(2 rows)

-- nested scenario
DROP TABLE IF EXISTS t1;
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        DECLARE CONTINUE HANDLER FOR SQLWARNING 
        BEGIN
            resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'column is not defined';
        END;
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'column is not defined2222';
    END;
    DROP TABLE t1;
END;
/
call p1();
WARNING:  column is not defined
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
 p1 
----
 
(1 row)

show warnings;
  level  | code  |          message          
---------+-------+---------------------------
 Error   | 42P01 | table "t1" does not exist
 Warning | 01000 | column is not defined2222
 Warning | 01000 | column is not defined
(3 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        DECLARE CONTINUE HANDLER FOR SQLSTATE '01000' 
        BEGIN
            resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'column is not defined';
        END;
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'column is not defined2222';
    END;
    DROP TABLE t1;
END;
/
call p1();
WARNING:  column is not defined
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
 p1 
----
 
(1 row)

show warnings;
  level  | code  |          message          
---------+-------+---------------------------
 Error   | 42P01 | table "t1" does not exist
 Warning | 01000 | column is not defined2222
 Warning | 01000 | column is not defined
(3 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
        BEGIN
            resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'column is not defined';
        END;
        resignal SQLSTATE '12000' SET MESSAGE_TEXT = 'column is not defined2222';
    END;
    DROP TABLE t1;
END;
/
call p1();
WARNING:  column is not defined
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
 p1 
----
 
(1 row)

show warnings;
  level  | code  |          message          
---------+-------+---------------------------
 Error   | 42P01 | table "t1" does not exist
 Error   | 03000 | column is not defined2222
 Warning | 01000 | column is not defined
(3 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        DECLARE EXIT HANDLER FOR SQLWARNING 
        BEGIN
            resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'column is not defined';
            select 1 into a;
        END;
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'column is not defined2222';
    END;
    DROP TABLE t1;
END;
/
call p1(0);
WARNING:  column is not defined
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        DECLARE CONTINUE HANDLER FOR SQLWARNING 
        BEGIN
            resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'column is not defined';
            select 1 into a;
        END;
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'column is not defined2222';
    END;
    DROP TABLE t1;
END;
/
call p1(0);
WARNING:  column is not defined
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        DECLARE CONTINUE HANDLER FOR SQLWARNING 
        BEGIN
            resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'column is not defined';
        END;
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'column is not defined2222';
        select 1 into a;
    END;
    DROP TABLE t1;
END;
/
call p1(0);
WARNING:  column is not defined
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
 a 
---
 1
(1 row)

show warnings;
 level | code | message 
-------+------+---------
(0 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1(a out int) IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        DECLARE EXIT HANDLER FOR SQLWARNING 
        BEGIN
            resignal SQLSTATE '01111' SET MESSAGE_TEXT = 'column is not defined';
        END;
        resignal SQLSTATE '01000' SET MESSAGE_TEXT = 'column is not defined2222';
        select 1 into a;
    END;
    DROP TABLE t1;
END;
/
call p1(0);
WARNING:  column is not defined
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
 a 
---
  
(1 row)

show warnings;
  level  | code  |          message          
---------+-------+---------------------------
 Error   | 42P01 | table "t1" does not exist
 Warning | 01000 | column is not defined2222
 Warning | 01000 | column is not defined
(3 rows)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
DROP VIEW IF EXISTS v1;
NOTICE:  view "v1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
        BEGIN
            resignal SQLSTATE '42S02' SET MESSAGE_TEXT = 'column is not defined', MYSQL_ERRNO = 1051;
        END;
        DROP VIEW v1;
        resignal SQLSTATE '42S02' SET MESSAGE_TEXT = 'column is not defined2222', MYSQL_ERRNO = 1051;
    END;
    DROP TABLE t1;
END;
/
call p1();
ERROR:  column is not defined
CONTEXT:  PL/pgSQL function p1() line 6 at RESIGNAL
show warnings;
 level | code  |         message          
-------+-------+--------------------------
 Error | 42P01 | view "v1" does not exist
 Error | 1051  | column is not defined
(2 rows)

CREATE OR REPLACE PROCEDURE p1() IS
BEGIN
    DECLARE CONTINUE HANDLER FOR 1 resignal SQLSTATE '22012' SET MYSQL_ERRNO = 1000, MESSAGE_TEXT='mysql_errno is 1';
    signal sqlstate '22012' SET MYSQL_ERRNO = 1;
END;
/
call p1();
ERROR:  Unhandled user-defined exception condition
CONTEXT:  PL/pgSQL function p1() line 3 at SIGNAL
show warnings;
 level | code |                  message                   
-------+------+--------------------------------------------
 Error | 1    | Unhandled user-defined exception condition
(1 row)

-- mysql example
set b_format_behavior_compat_options = 'enable_set_variables';
CREATE OR REPLACE PROCEDURE p2(numerator in int, denominator in int, result out number) IS
BEGIN
    DECLARE divisio_by_zero condition for SQLSTATE '22012';
    DECLARE CONTINUE handler for divisio_by_zero
        resignal set message_text = 'division by zero / denominator cannot be zero';
    IF denominator = 0 THEN
        signal divisio_by_zero;
    ELSE 
        result := numerator / denominator;
    END IF;
END;
/
call p3(1, 0, 1);
ERROR:  function "p3" doesn't exist 
show warnings;
 level | code  |           message            
-------+-------+------------------------------
 Error | 42883 | function "p3" doesn't exist 
(1 row)

call p3(2, 1, 0);
ERROR:  function "p3" doesn't exist 
DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET subclass_origin = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal sqlstate '45000' SET mysql_errno = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
 Error | 5     | table "t1" does not exist
(2 rows)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET mysql_errno = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code |          message          
-------+------+---------------------------
 Error | 5    | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET constraint_catalog = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET constraint_schema = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET constraint_name = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET catalog_name = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET schema_name = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET table_name = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET column_name = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

DROP TABLE IF EXISTS t1;
NOTICE:  table "t1" does not exist, skipping
CREATE OR REPLACE PROCEDURE p2() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET @error_count = @error_count + 1;
        IF @a = 0 THEN 
            resignal SET cursor_name = 5;
        END IF;
    END;
    DROP TABLE t1;
END;
/
SET @error_count = 1;
SET @a = 0;
call p2();
ERROR:  table "t1" does not exist
CONTEXT:  PL/pgSQL function p2() line 6 at RESIGNAL
show warnings;
 level | code  |          message          
-------+-------+---------------------------
 Error | 42P01 | table "t1" does not exist
(1 row)

select @a, @error_count;
 @a | @error_count 
----+--------------
  0 |            2
(1 row)

CREATE OR REPLACE PROCEDURE p() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate 01001;
    END;
    DROP TABLE t1;
END;
/
ERROR:  syntax error, the expected value is a string. at or near "01001"
LINE 4:         resignal sqlstate 01001;
                                  ^
QUERY:   DECLARE BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate 01001;
    END;
    DROP TABLE t1;
END
CREATE OR REPLACE PROCEDURE p() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate value 01001;
    END;
    DROP TABLE t1;
END;
/
ERROR:  syntax error, the expected value is a string. at or near "01001"
LINE 4:         resignal sqlstate value 01001;
                                        ^
QUERY:   DECLARE BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate value 01001;
    END;
    DROP TABLE t1;
END
CREATE OR REPLACE PROCEDURE p() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate values 01001;
    END;
    DROP TABLE t1;
END;
/
ERROR:  syntax error, the expected word is value. at or near "values"
LINE 4:         resignal sqlstate values 01001;
                                  ^
QUERY:   DECLARE BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate values 01001;
    END;
    DROP TABLE t1;
END
CREATE OR REPLACE PROCEDURE p() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate value;
    END;
    DROP TABLE t1;
END;
/
ERROR:  syntax error, the expected value is a string. at or near ";"
LINE 4:         resignal sqlstate value;
                                       ^
QUERY:   DECLARE BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate value;
    END;
    DROP TABLE t1;
END
CREATE OR REPLACE PROCEDURE p() IS
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate values;
    END;
    DROP TABLE t1;
END;
/
ERROR:  syntax error, the expected word is value. at or near "values"
LINE 4:         resignal sqlstate values;
                                  ^
QUERY:   DECLARE BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        resignal sqlstate values;
    END;
    DROP TABLE t1;
END
\c regression
drop database mysql_test_resignal;
